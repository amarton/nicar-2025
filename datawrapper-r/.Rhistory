title="Minneapolis reported crime, 2019-2024"
)
dw_data_to_chart(crime_summary, bar_chart)
dw_edit_chart(bar_chart, title = "Crime in Minneapolis hit a three-year low in 2024",
intro = "Reported crimes in the city between 2019 and 2024 hit a high mark in 2022 but have been on the decline since.", source_name = "Open Data Minneapolis")
dw_retrieve_chart_metadata(bar_chart)
dw_edit_chart(bar_chart,
byline = "Adam Marton",
visualize = list(
"base-color" = "#a47764",
"thick" = "true",
"value-label-alignment" = "right"
)
)
dw_publish_chart(bar_chart)
crimes_2024 <- crime_data %>%
filter(Year == 2024)
crime_offense_summary <- crimes_2024 %>%
count(Offense_Category)
View(crimes_2024)
View(crime_offense_summary)
crime_offense_summary <- crime_offense_summary %>%
arrange(desc(n)) %>%
slice(1:10)
offense_chart <- dw_copy_chart(copy_from = "L4qtv")
dw_data_to_chart(crime_offense_summary, offense_chart)
dw_edit_chart(offense_chart, title = "Top 10 highest categories of crime offenses in Minneapolis in 2024",
intro = "Almost 13,000 larceny and theft offenses and over 8,000 assault offenses were reported.", source_name = "Open Data Minneapolis")
dw_retrieve_chart_metadata(bar_chart)
dw_retrieve_chart_metadata(offense_chart)
dw_edit_chart(offense_chart,
visualize = list(
"base-color" = "#8ACE00",
"sort-bars" = "true",
"rules" = "true",
"background" = "true",
"block-labels" = "true",
"value-label-alignment" = "right"
)
)
View(crime_data)
my_function <- function() {
#make a new data frame for a precinct
precinct_data <- crime_data %>% filter(Precinct== 1)
#count number of arrests per year in that precinct
precinct_summary <- precinct_data %>%count(year)
#create new chart
my_chart <- dw_create_chart(
type="d3-bars",
)
#add data
dw_data_to_chart(precinct_summary, my_chart)
#edit chart
dw_edit_chart(my_chart, title = paste("Reported crimes by year in Minneapolis Precinct 1"), source_name = "Open Data Minneapolis")
#publish
dw_publish_chart(my_chart)
}
my_function <- function() {
#make a new data frame for a precinct
precinct_data <- crime_data %>% filter(Precinct== 1)
#count number of arrests per year in that precinct
precinct_summary <- precinct_data %>%count(year)
#create new chart
my_chart <- dw_create_chart(
type="d3-bars",
)
#add data
dw_data_to_chart(precinct_summary, my_chart)
#edit chart
dw_edit_chart(my_chart, title = paste("Reported crimes by year in Minneapolis Precinct 1"), source_name = "Open Data Minneapolis")
#publish
dw_publish_chart(my_chart)
}
my_function()
my_function <- function() {
#make a new data frame for a precinct
precinct_data <- crime_data %>% filter(Precinct== 1)
#count number of arrests per year in that precinct
precinct_summary <- precinct_data %>%count(Year)
#create new chart
my_chart <- dw_create_chart(
type="d3-bars",
)
#add data
dw_data_to_chart(precinct_summary, my_chart)
#edit chart
dw_edit_chart(my_chart, title = paste("Reported crimes by year in Minneapolis Precinct 1"), source_name = "Open Data Minneapolis")
#publish
dw_publish_chart(my_chart)
}
my_function()
View(my_function)
View(my_function)
#add a condition called precinct
my_function <- function(precinct) {
#instead of naming the precinct here, call the condition value
precinct_data <- crime_data %>% filter(precinct)
precinct_summary <- precinct_data %>%count(Year)
my_chart <- dw_create_chart(
type="d3-bars",
)
dw_data_to_chart(precinct_summary, my_chart)
#Again, call in the condition value instead of naming the specific precinct
dw_edit_chart(my_chart, title = paste("Reported crimes by year in Minneapolis Precinct", precinct), source_name = "Open Data Minneapolis")
dw_publish_chart(my_chart)
}
#Call the function to run it
my_function(2)
#add a condition called precinct
my_function <- function(precinct) {
#instead of naming the precinct here, call the condition value
precinct_data <- crime_data %>% filter(precinct)
precinct_summary <- precinct_data %>%count(Year)
my_chart <- dw_create_chart(
type="d3-bars",
)
dw_data_to_chart(precinct_summary, my_chart)
#Again, call in the condition value instead of naming the specific precinct
dw_edit_chart(my_chart, title = paste("Reported crimes by year in Minneapolis Precinct", precinct), source_name = "Open Data Minneapolis")
dw_publish_chart(my_chart)
}
#Call the function to run it
my_function("2")
#add a condition called precinct
my_function <- function(precinct) {
#instead of naming the precinct here, call the condition value
precinct_data <- crime_data %>% filter(Precinct == precinct)
precinct_summary <- precinct_data %>%count(Year)
my_chart <- dw_create_chart(
type="d3-bars",
)
dw_data_to_chart(precinct_summary, my_chart)
#Again, call in the condition value instead of naming the specific precinct
dw_edit_chart(my_chart, title = paste("Reported crimes by year in Minneapolis Precinct", precinct), source_name = "Open Data Minneapolis")
dw_publish_chart(my_chart)
}
#Call the function to run it
my_function("2")
for(precinct in unique(crime_data$Precinct)) {
my_function(precinct)
}
View(crimes_2024)
now = Sys.Date()
temp <- subset(crimes_2024, crimes_2024$Reported_Date > now-30)
View(temp)
now = Sys.Date()
temp <- subset(crimes_2024, crimes_2024$Reported_Date > now-7)
now = Sys.Date()
temp <- subset(crimes_2024, crimes_2024$Reported_Date > now-30)
#First we set today's date
# let's fake the current date to make this example immortal:
now = as.Date("12/15/2024", format = "%m/%d/%Y")
# however, you should replace it with:
# now = Sys.Date()
#Next, let's make a new dataframe that only shows crimes seven days before "now"
crimes_last_7 <- subset(crimes_2024, crimes_2024$Reported_Date > now-7)
View(crimes_last_7)
View(crimes_last_7)
View(temp)
#First we set today's date
# let's fake the current date to make this example immortal:
now = as.Date("12/15/2024", format = "%m/%d/%Y")
# however, you should replace it with:
# now = Sys.Date()
#Next, let's make a new dataframe that only shows crimes seven days before "now"
crimes_last_7 <- subset(crimes_2024, crimes_2024$Reported_Date > now-7)
#First we set today's date
# let's fake the current date to make this example immortal:
now = as.Date("12/31/2024", format = "%m/%d/%Y")
# however, you should replace it with:
# now = Sys.Date()
#Next, let's make a new dataframe that only shows crimes seven days before "now"
crimes_last_7 <- subset(crimes_2024, crimes_2024$Reported_Date > now-30)
#First we set today's date
# let's fake the current date to make this example immortal:
now = as.Date("12/31/2024", format = "%m/%d/%Y")
# however, you should replace it with:
# now = Sys.Date()
#Next, let's make a new dataframe that only shows crimes seven days before "now"
crimes_last_7 <- subset(crimes_2024, crimes_2024$Reported_Date > now-7)
new_symbol_chart <- dw_create_chart(
title = "Crimes in the last seven days",
type = "d3-maps-symbols"
)
library(DatawRappr)
library(tidyverse)
#datawrapper_auth(api_key =  "sOa38CEKU6BxzY7v2OS7KwL3PN2ZZO9qNmjIty4hqa82LZMJgnW7D90Wx9uHPIqA")
new_symbol_chart <- dw_create_chart(
title = "Crimes in the last seven days",
type = "d3-maps-symbols"
)
head(dw_basemaps)
view(dw_basemaps)
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "X",
lon = "Y",
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "X",
lon = "Y",
vlaue = "#000000"
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "Y",
lon = "X",
vlaue = "#000000"
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
dw_data_to_chart(crimes_last_7, chart_id = new_symbol_chart)
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "Y",
lon = "X",
vlaue = "#000000"
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "X",
lon = "Y",
vlaue = "#000000"
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "Latitude",
lon = "Longitude",
vlaue = "#000000"
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ Reported_Date }}",
title = "{{ Case_Number }}"
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ Reported_Date }}",
title = "{{ Case_Number }}",
fields = list(
"Reported_Date" = "Reported_Date",
"Case_Number" = "Case_Number"
)
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ body }}",
title = "{{ title }}",
fields = list(
"body" = "Reported_Date",
"title" = "Case_Number"
)
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ body }}",
title = "{{ title }}",
fields = list(
"body" = "reported_date",
"title" = "case_number"
)
)))
dw_retrieve_chart_metadata(new_symbol_chart)
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ body }}",
title = "{{ title }}",
fields = list(
"body" = "reported_date",
"title" = "case_number"
)
enabled = "TRUE"
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ body }}",
title = "{{ title }}",
fields = list(
"body" = "reported_date",
"title" = "case_number"
),
enabled = "TRUE"
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ body }}",
title = "{{ title }}",
fields = list(
"body" = "Reported_Date",
"title" = "Case_Number"
),
enabled = "TRUE"
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ body }}",
title = "{{ Case_Number }}",
fields = list(
"body" = "Reported_Date",
"Case_Number" = "Case_Number"
),
enabled = "TRUE"
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ body }}",
title = "{{ case_number }}",
fields = list(
"body" = "Reported_Date",
"case_number" = "case_number"
),
enabled = "TRUE"
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ reported_date }}",
title = "{{ case_number }}",
fields = list(
"reported_date" = "reported_date",
"case_number" = "case_number"
),
enabled = "TRUE"
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "{{ reported_date }}",
title = "{{ offense }}",
fields = list(
"reported_date" = "reported_date",
"offense" = "offense"
),
enabled = "TRUE"
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "Reported Date: {{ reported_date }}<br> (( address }}",
title = "{{ offense }}",
fields = list(
"reported_date" = "reported_date",
"offense" = "offense"
"address" = "address"
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "Reported Date: {{ reported_date }}<br> (( address }}",
title = "{{ offense }}",
fields = list(
"reported_date" = "reported_date",
"offense" = "offense",
"address" = "address"
),
enabled = "TRUE"
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "Reported Date: {{ reported_date }}<br> {{ address }}",
title = "{{ offense }}",
fields = list(
"reported_date" = "reported_date",
"offense" = "offense",
"address" = "address"
),
enabled = "TRUE"
)))
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "Reported Date: {{ reported_date }}<br> Address: {{ address }}",
title = "{{ offense }}",
fields = list(
"reported_date" = "reported_date",
"offense" = "offense",
"address" = "address"
),
enabled = "TRUE"
)))
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "Latitude",
lon = "Longitude",
value = "Offense_Category"
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "Reported Date: {{ reported_date }}<br> Address: {{ address }}",
title = "{{ offense }}",
fields = list(
"reported_date" = "reported_date",
"offense" = "offense",
"address" = "address"
),
enabled = "TRUE"
)))
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "Latitude",
lon = "Longitude",
value = "Offense_Category"
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
```{r}
dw_retrieve_chart_metadata(bar_chart)
dw_retrieve_chart_metadata(new_symbol_chart)
dw_retrieve_chart_metadata(new_symbol_chart)
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "Latitude",
lon = "Longitude"
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
dw_retrieve_chart_metadata(new_symbol_chart)
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "Latitude",
lon = "Longitude",
values = "Offense_Category"
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "Reported Date: {{ reported_date }}<br> Address: {{ address }}",
title = "{{ offense }}",
fields = list(
"reported_date" = "reported_date",
"offense" = "offense",
"address" = "address"
),
enabled = "TRUE"
)))
dw_publish_chart(new_symbol_chart)
new_symbol_chart <- dw_create_chart(
title = "Crimes in Minneapolis in the last seven days",
type = "d3-maps-symbols"
)
dw_data_to_chart(crimes_last_7, chart_id = new_symbol_chart)
dw_edit_chart(new_symbol_chart,
axes = list(
lat = "Latitude",
lon = "Longitude",
values = "Offense_Category"
),
visualize = list(
basemap = "minneapolis-neighborhoods"
)
)
dw_edit_chart(new_symbol_chart, visualize = list(
tooltip = list(
body = "Reported Date: {{ reported_date }}<br> Address: {{ address }}",
title = "{{ offense }}",
fields = list(
"reported_date" = "reported_date",
"offense" = "offense",
"address" = "address"
),
enabled = "TRUE"
)))
dw_publish_chart(new_symbol_chart)
crime_data <- read.csv("mn-crime-data.csv")
head(crime_data)
crime_data$Year <- year(crime_data$Reported_Date)
crime_data <- crime_data %>%
filter(Year < 2025)
crime_summary <- crime_data %>%
count(Year)
nrow(crime_data)
sum(crime_summary$n)
crime_summary <- crime_summary %>%
rename("Reported crimes" = "n")
my_chart <- dw_create_chart()
dw_data_to_chart(crime_summary, my_chart)
dw_edit_chart(my_chart, title = "Crime in Minneapolis hit a three-year low in 2024",
intro = "Reported crimes in the city between 2019 and 2024 hit a high mark in 2022 but have been on the decline since.", source_name = "Open Data Minneapolis")
dw_publish_chart(my_chart)
png_chart <- dw_export_chart(my_chart, type = "png")
magick::image_write(png_chart, "OUTPUT.png")
png_chart <- dw_export_chart(my_chart, type = "png")
magick::image_write(png_chart, "line-chart.png")
unlink("minneapolis-crime-data-work_cache", recursive = TRUE)
knit_with_parameters("~/Documents/GitHub/nicar2025/datawrapper-r/minneapolis-crime-data-work.Rmd")
